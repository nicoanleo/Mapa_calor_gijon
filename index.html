<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mapa de Antigüedad de Instalaciones Eléctricas – Gijón</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- Archivo CSS externo -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Mapa de Antigüedad de Instalaciones Eléctricas – Gijón</h1>
        <p class="lead">En el mapa se muestran las zonas marcadas en rojo donde las instalaciones eléctricas presentan mayor antigüedad.
          Si tu vivienda se encuentra dentro de una de estas áreas, te recomendamos ponerte en contacto con nosotros a través del formulario que encontrarás más abajo para evaluar tu situación cuanto antes.
          
          Si no resides en una zona marcada pero aun así deseas contactar con nosotros, también puedes rellenar el formulario; en ese caso, por favor indícalo y especifica que no se trata de una solicitud urgente.</p>
      </div>
      <nav>
        <a class="small" href="#contacto">Contacto</a> •
        <a class="small" href="#charlas">Charlas</a>
      </nav>
    </header>

    <main class="layout">
      <section class="card">
        <div id="map"></div>
        <div class="legend" id="legend">
          <div class="row"><div class="swatch" style="background:#fff0f0"></div> <small>Baja antigüedad</small></div>
          <div class="row"><div class="swatch" style="background:#ff9999"></div> <small>Media antigüedad</small></div>
          <div class="row"><div class="swatch" style="background:#c40000"></div> <small>Alta antigüedad</small></div>
        </div>
      </section>

      <aside class="sidebar">
        <div class="card section" id="contacto">
          <h3>Contacto</h3>
          <form id="contactForm">
            <label>Nombre</label>
            <input type="text" required />

            <label>Email</label>
            <input type="email" required />

            <label>Mensaje</label>
            <textarea rows="4" required></textarea>

            <button type="submit">Enviar</button>
          </form>
        </div>

        <div class="card section" id="charlas">
          <h3>Organizar charlas</h3>
          <form id="talkForm">
            <label>Título</label>
            <input type="text" required />

            <label>Fecha</label>
            <input type="date" />

            <button type="submit">Proponer charla</button>
          </form>

          <h4>Próximas charlas</h4>
          <ul class="talks-list" id="talkList">
            <li><strong>Renovación segura</strong><br><small>15/01/2026</small></li>
          </ul>
        </div>
      </aside>
    </main>

    <footer>
      © <span id="year"></span> Gijón
    </footer>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();
  
    // Inicializar mapa
    const map = L.map("map").setView([43.5322, -5.6611], 13);
  
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "© OpenStreetMap"
    }).addTo(map);
  
    // --- GeoJSON de ejemplo (barrios de Gijón) ---
    const barriosGeoJSON = {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "properties": { "name": "Cimavilla", "age": 0.95 },
          "geometry": {
            "type": "Polygon",
            "coordinates": [[
            [-5.665458670835704,43.54845768464952], [-5.666243309789337, 43.548008356070426],[-5.6638923973738144, 43.545212000602675], [-5.662303630961787, 43.54556274155121], [-5.660519519676853, 43.546129844056594], [-5.660442465001864, 43.547354920117016], [-5.661953921433025, 43.54720025946639], [-5.663477232422878, 43.54740647357207]
            ]]
          }
        },
        {
          "type": "Feature",
          "properties": { "name": "La Calzada", "age": 0.67 },
          "geometry": {
            "type": "Polygon",
            "coordinates": [[
            [-5.701084704161843, 43.54165372227905], [-5.699904199505227, 43.535448616542624], [-5.693804206666783, 43.5356326483473], [-5.693887640628901, 43.537193716022244], [-5.692814417666, 43.53722992797583], [-5.692806951326617, 43.537608804909695], [-5.691455545294332, 43.537792830002445], [-5.693090671920032, 43.53965469932183], [-5.69518314335869, 43.54218001235188], [-5.695474330281627, 43.54197435217918], [-5.6974200090032525, 43.54319099355766], [-5.6981334292452175, 43.54261700769081], [-5.69954906413588, 43.54203760122712]
          ]]
          }
        },
        {
          "type": "Feature",
          "properties": { "name": "Viesques", "age": 0.43 },
          "geometry": {
            "type": "Polygon",
            "coordinates": [[
            [-5.643135240295749, 43.52763387730897], [-5.641911822003323, 43.52501197883379], [-5.639778439269236, 43.524659003053074], [-5.6397641212785175, 43.522727981332594], [ -5.649181281055206, 43.521041888997104], [-5.653833668588788, 43.51972660474914], [-5.657341579744269, 43.52039108229266], [-5.655115757167522, 43.527739891360085], [-5.652403490151528, 43.52776058170943], [-5.6508355811773185, 43.52858181125288], [-5.650785641611918, 43.52922320192786], [-5.649851058230638, 43.5298645857724], [-5.648812316828696, 43.530285335334554], [-5.64715004260691, 43.529302573822406], [-5.644046655099004, 43.529002569753345]
            ]]
          }
        }
      ]
    };
  
    // Función para asignar color según antigüedad
    function styleByAge(feature) {
      const age = feature.properties.age || 0;
      let fillColor;
      if(age > 0.9) fillColor = '#c40000';      // muy antiguo
      else if(age > 0.6) fillColor = '#ff9999'; // intermedio
      else fillColor = '#fff0f0';               // reciente
      return { color: '#900', weight: 1, fillColor: fillColor, fillOpacity: 0.7 };
    }
  
    // Añadir GeoJSON al mapa
    const barriosLayer = L.geoJSON(barriosGeoJSON, {
      style: styleByAge,
      onEachFeature: function(feature, layer){
        layer.bindPopup(`<strong>${feature.properties.name}</strong><br>Antigüedad estimada: ${(feature.properties.age*100).toFixed(0)}%`);
      }
    }).addTo(map);
  
    // Ajustar vista al límite de los barrios
    map.fitBounds(barriosLayer.getBounds().pad(0.2));
  </script>
</body>
</html>
